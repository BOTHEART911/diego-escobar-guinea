<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>DIEGO ESCOBAR GUINEA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="https://res.cloudinary.com/dqqeavica/image/upload/v1766959933/favicon_xqf1p1.png">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
  :root{
    --primary:#06402B;
    --primary-2:#04281C;
    --ok:#16a34a;
    --error:#dc2626;
    --scrim:rgba(0,0,0,.35);
  }
  html,body{
    margin:0; padding:0; height:100%; width:100%;
    overflow-x:hidden;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:#111;
    background: url('https://res.cloudinary.com/dqqeavica/image/upload/v1747012335/fondo_gris_ecirb4.png') center/cover fixed no-repeat;
  }
  .container{ max-width: 1100px; margin: 0 auto; padding: 16px; }

  .view{
    display:none;
    opacity:0;
    transform: translateY(8px);
    transition: opacity .25s ease, transform .25s ease;
    box-sizing:border-box;
    padding:16px;
  }
  .view.active{
    display:block;
    opacity:1;
    transform: translateY(0);
  }

  .card{
    background: rgba(255,255,255,.06);
    backdrop-filter: blur(3px);
    border: 2px solid #ddd;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,.18);
    max-width: 820px;
    margin: 16px auto;
    padding: 20px 20px 16px;
  }
  h1,h2,h3{ margin: 8px 0 12px; text-align:center; }
  p.helper{ color:#444; font-size:.95rem; text-align:center; margin:8px 0 16px; }
  label{ display:block; font-weight:700; margin: 10px 0 6px; color:var(--primary); }
  input, select, textarea, button{
    width:100%; padding:12px; box-sizing:border-box;
    border:1.5px solid #ccc; border-radius:8px; background:#fff;
    outline:none; transition: border-color .2s ease, transform .08s ease;
    font-size:16px;
  }
  input:focus, select:focus, textarea:focus{ border-color:var(--primary); }
  button{
    cursor:pointer; border:2px solid var(--primary);
    background:#fff; color:#000; font-weight:700;
  }
  button:hover{ background:var(--primary-2); color:#fff; border-color:var(--primary-2); }
  .btn-primary{ background:var(--primary); color:#fff; }
  .btn-row{ display:flex; gap:12px; flex-wrap:wrap; }
  .btn-row > *{ flex:1; }
  .muted{ color:#666; font-size:.85rem; }
  .center{ text-align:center; }
  .brand{
    width:240px;
    border-radius:12px;
    display:block;
    margin:12px auto 4px;
  }
  .banner-bottom{
    width:240px;
    border-radius:12px;
    display:block;
    margin:16px auto 8px;
  }
  .danger{
    padding:8px 14px;
    border-radius:999px;
    border:2px solid #e11;
    background:#e11;
    color:#fff;
    font-weight:700;
  }

  /* Loader centrado */
  .loader{
    position:fixed; inset:0;
    display:flex; align-items:center; justify-content:center;
    background:rgba(0,0,0,.35);
    z-index:9999; backdrop-filter: blur(2px);
    opacity:1; transition: opacity .12s ease;
    will-change: opacity;
  }
  .loader.hidden{
    opacity:0; pointer-events:none;
  }

  .spinner-ios{
    position:relative; width:64px; height:64px;
  }
  .spinner-ios i{
    position:absolute; left:50%; top:50%;
    width:6px; height:18px; margin:-9px 0 0 -3px;
    background:#fff; border-radius:3px;
    opacity:.2;
    animation:iosFade 1.2s linear infinite;
    transform-origin: center center;
  }
  @keyframes iosFade{
    0%, 39%, 100% { opacity:.2; }
    40% { opacity:1; }
  }
  .spinner-ios i:nth-child(1)  { transform: rotate(  0deg) translateY(-24px); animation-delay:-1.1s; }
  .spinner-ios i:nth-child(2)  { transform: rotate( 30deg) translateY(-24px); animation-delay:-1.0s; }
  .spinner-ios i:nth-child(3)  { transform: rotate( 60deg) translateY(-24px); animation-delay:-0.9s; }
  .spinner-ios i:nth-child(4)  { transform: rotate( 90deg) translateY(-24px); animation-delay:-0.8s; }
  .spinner-ios i:nth-child(5)  { transform: rotate(120deg) translateY(-24px); animation-delay:-0.7s; }
  .spinner-ios i:nth-child(6)  { transform: rotate(150deg) translateY(-0.6s); animation-delay:-0.6s; }
  .spinner-ios i:nth-child(7)  { transform: rotate(180deg) translateY(-24px); animation-delay:-0.5s; }
  .spinner-ios i:nth-child(8)  { transform: rotate(210deg) translateY(-24px); animation-delay:-0.4s; }
  .spinner-ios i:nth-child(9)  { transform: rotate(240deg) translateY(-24px); animation-delay:-0.3s; }
  .spinner-ios i:nth-child(10) { transform: rotate(270deg) translateY(-24px); animation-delay:-0.2s; }
  .spinner-ios i:nth-child(11) { transform: rotate(300deg) translateY(-24px); animation-delay:-0.1s; }
  .spinner-ios i:nth-child(12) { transform: rotate(330deg) translateY(-24px); animation-delay: 0s; }

  .hidden{ display:none !important; }

  .narrow{ max-width: 560px; margin: 0 auto; }
  .spaced{ margin-top:12px; }



  .typing-cursor{
    display:inline-block;
    width:2px;
    height:1.1em;
    background:#031732;
    margin-left:3px;
    vertical-align:baseline;
    animation:blink 0.9s steps(2,start) infinite;
  }
  @keyframes blink{
    0%,49%{opacity:1;}
    50%,100%{opacity:0;}
  }

  /* Bot√≥n instalar PWA */
  #btn-instalar{
    border-radius:999px;
    font-size:1rem;
    padding:12px 18px;
  }

  @media (max-width:700px){
    .btn-row{ flex-direction:column; }
  }
  </style>
</head>
<body>

<!-- Loader -->
<div id="loader" class="loader hidden" aria-live="polite" aria-busy="true">
  <div class="spinner-ios" role="status" aria-label="Cargando">
    <i></i><i></i><i></i><i></i><i></i><i></i>
    <i></i><i></i><i></i><i></i><i></i><i></i>
  </div>
</div>

<div class="container">

  <!-- VISTA INSTALAR -->
  <section id="view-instalar" class="view">
    <div class="card narrow" style="text-align:center;">
      <h2 style="color:var(--primary);">APP DIEGO ESCOBAR GUINEA</h2>
      <img class="brand" alt="Instalar" src="https://res.cloudinary.com/dqqeavica/image/upload/v1766959935/animacion_bxjhh7.gif" />
      <p style="font-weight:600;">
        Instala esta App en tu dispositivo para tener la mejor experiencia.
      </p>
      <div class="btn-row" style="justify-content:center; margin-top:12px;">
        <button id="btn-instalar" class="btn-primary" style="display:none;">Instalar la App üì≤</button>
      </div>
      <p class="muted" style="margin-top:14px;">
        Si ya instalaste la App y no se inicia autom√°ticamente, refresca en unos segundos.
      </p>
    </div>
  </section>

  <!-- VISTA BIENVENIDA -->
  <section id="view-bienvenida" class="view">
    <div class="card narrow">
      <h1 style="color:var(--primary); text-shadow: 0 2px 2px #031732;">
        DIEGO ESCOBAR GUINEA
      </h1>
      <p class="helper">
        APP oficial de <b>DIEGO ESCOBAR GUINEA</b>.
      </p>

      <!-- Texto din√°mico tipo typing -->
    <p class="center muted" style="margin-top:12px;">
  <span id="typing-text" class="typing-text"></span>
  <span class="typing-cursor"></span>
</p>

      <img class="banner-bottom" alt="Banner" src="https://res.cloudinary.com/dqqeavica/image/upload/v1754317968/GIRARDOT_D.E_w09gee.png" />
      <p class="center muted">Copyright ¬© <b>OSCAR POLANIA</b></p>
    </div>
  </section>

</div>

<script>
/* ================== SONIDOS ================== */
const SOUNDS = {
  question: 'https://res.cloudinary.com/dqqeavica/video/upload/v1759011577/Pay_fail_ls2aif.mp3',
  info: 'https://res.cloudinary.com/dqqeavica/video/upload/v1759011578/Default_notification_pkp4wr.mp3',
  success: 'https://res.cloudinary.com/dqqeavica/video/upload/v1759011577/Pay_success_t5aawh.mp3',
  error: 'https://res.cloudinary.com/dqqeavica/video/upload/v1759011578/Low_battery_d5qua1.mp3',
  warning: 'https://res.cloudinary.com/dqqeavica/video/upload/v1759011578/Low_battery_d5qua1.mp3',
  back: 'https://res.cloudinary.com/dqqeavica/video/upload/v1759011578/Keyboard_Enter_b9k2dc.mp3'
};

function playSoundOnce(url){
  try{
    const a = new Audio(url);
    a.preload = 'auto';
    a.play().catch(()=>{});
  }catch(e){}
}

if (window.Swal && typeof Swal.fire === 'function'){
  const __fire = Swal.fire.bind(Swal);
  Swal.fire = function(options = {}, ...rest){
    try{
      const icon = options.icon || options.type;
      if (icon && SOUNDS[icon]) playSoundOnce(SOUNDS[icon]);
    }catch(e){}
    return __fire(options, ...rest);
  }
}

/* ================== LOADER ================== */
const loader = document.getElementById('loader');
let loadingCount = 0;
let loaderTimer = null;

function startLoading(){
  loadingCount++;
  if (loadingCount === 1){
    loaderTimer = setTimeout(()=>{
      loader.classList.remove('hidden');
      loaderTimer = null;
    }, 120);
  }
}
function stopLoading(){
  if (loadingCount === 0) return;
  loadingCount--;
  if (loadingCount === 0){
    if (loaderTimer){
      clearTimeout(loaderTimer);
      loaderTimer = null;
    }
    loader.classList.add('hidden');
  }
}

/* ================== VISTAS ================== */
function showView(id){
  for(const el of document.querySelectorAll('.view')) el.classList.remove('active');
  const v = document.getElementById(id);
  if(v) v.classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* ================== TYPING EFFECT ================== */
const typingMessage =
  'Muy pronto tendr√°s acceso a todas las funcionalidades desde esta App.';

let typingIndex = 0;
let typingDirection = 1; // 1 = escribe, -1 = borra
let typingPause = false;

function startTypingLoop(){
  const el = document.getElementById('typing-text');
  if (!el) return;

  function tick(){
    if (!typingPause){
      if (typingDirection === 1){
        typingIndex++;
        if (typingIndex >= typingMessage.length){
          typingIndex = typingMessage.length;
          typingPause = true;
          setTimeout(()=>{
            typingPause = false;
            typingDirection = -1;
          }, 2600); // pausa al terminar de escribir
        }
      } else {
        typingIndex--;
        if (typingIndex <= 0){
          typingIndex = 0;
          typingPause = true;
          setTimeout(()=>{
            typingPause = false;
            typingDirection = 1;
          }, 800); // pausa al vaciar
        }
      }
      el.textContent = typingMessage.slice(0, typingIndex);
    }

    // vuelve a llamar con un peque√±o retraso
    setTimeout(tick, 45);
  }

  tick(); // inicia el ciclo
}

/* ================== PWA AVANZADO ================== */
let deferredPrompt = null;
let __installStartShown = false;    // bandera: ya mostramos "App instal√°ndose"
let __installSuccessShown = false;  // bandera: ya mostramos "Instalaci√≥n exitosa"

function isStandalone(){
  const dmStandalone = window.matchMedia('(display-mode: standalone)').matches;
  const dmInstalled  = window.matchMedia('(display-mode: installed)').matches;
  const iosStandalone = (window.navigator.standalone === true);
  return dmStandalone || dmInstalled || iosStandalone;
}
function isIOS(){
  return /(iphone|ipad|ipod)/i.test(navigator.userAgent || '');
}
function isMarkedInstalled(){
  try{ return localStorage.getItem('pwaInstalledFlag') === '1'; }catch(_){ return false; }
}
function markInstalled(){
  try{ localStorage.setItem('pwaInstalledFlag', '1'); }catch(_){}
}
function clearInstalledMark(){
  try{ localStorage.removeItem('pwaInstalledFlag'); }catch(_){}
}
async function detectInstalled(){
  if (isStandalone()) return true;
  if (typeof navigator.getInstalledRelatedApps === 'function'){
    try{
      const apps = await navigator.getInstalledRelatedApps();
      const found = apps.some(a =>
        a.platform === 'webapp' &&
        typeof a.url === 'string' &&
        /manifest\.webmanifest$/.test(a.url)
      );
      if (found){
        markInstalled();
        return true;
      } else {
        clearInstalledMark();
      }
    }catch(_){}
  }
  return isMarkedInstalled();
}
function updateInstallButtonsVisibility(){
  const btn1 = document.getElementById('btn-instalar');
  const canPrompt = !!deferredPrompt;
  const installed = isMarkedInstalled() || isStandalone();
  const shouldShow = !installed && (canPrompt || isIOS());
  if(btn1) btn1.style.display = shouldShow ? '' : 'none';
}

window.addEventListener('beforeinstallprompt', (e)=>{
  e.preventDefault();
  deferredPrompt = e;
  updateInstallButtonsVisibility();
});

window.addEventListener('appinstalled', ()=>{
  markInstalled();
  deferredPrompt = null;
  updateInstallButtonsVisibility();
});

document.getElementById('btn-instalar').addEventListener('click', async ()=>{
  // Flujo iOS: se respeta exactamente tu alerta e instrucciones
  if(isIOS()){
    Swal.fire({
      icon:'info',
      title: '¬°Para Instalar en tu Iphone!',
  html: `
    <div style="text-align:center; margin-top:8px;">
      <img
        src="https://res.cloudinary.com/dqqeavica/image/upload/v1765745210/instalacion_ios_ysbhnd.gif"
        alt="Instalaci√≥n de IOS"
        style="width:180px; max-width:70vw; height:auto; display:block; margin:0 auto 12px;"
      >
      <div style="margin-top:10px;">
        <b>1.</b> Toca Compartir.<br><b>2.</b> Elige "Agregar a pantalla de inicio".<br><b>3.</b> Confirma "Agregar".
      </div>
    </div>
  `,
    });
    return;
  }
  // Android: requiere beforeinstallprompt (deferredPrompt)
  if(!deferredPrompt){
    Swal.fire({icon:'info',title:'Instalaci√≥n no disponible todav√≠a'});
    return;
  }

  const dp = deferredPrompt;
  dp.prompt();                           // muestra di√°logo nativo de instalaci√≥n
  const choice = await dp.userChoice;    // espera la elecci√≥n del usuario
  deferredPrompt = null;                 // limpia el prompt (solo se usa una vez)

  if (choice.outcome === 'accepted'){
    // Primera alerta (Android): confirma inicio de instalaci√≥n por 6 segundos
    markInstalled();
    __installStartShown = true;
    Swal.fire({
  icon: 'success',
  title: '¬°App instal√°ndose!',
  html: `
    <div style="text-align:center; margin-top:8px;">
      <img
        src="https://res.cloudinary.com/dqqeavica/image/upload/v1765740540/instalacion_lydtcl.gif"
        alt="Instalando app"
        style="width:180px; max-width:70vw; height:auto; display:block; margin:0 auto 12px;"
      >
      <div>Debes esperar unos segundos mientras el sistema instala la App.</div>
      <div style="margin-top:10px;">
        <b>Al desaparecer este aviso, puedes salir de esta vista. La App aparecer√° en la pantalla principal de este dispositivo.</b>
      </div>
    </div>
  `,
  timer: 12000,
  showConfirmButton: false
});
  } else {
    Swal.fire({icon:'info',title:'Instalaci√≥n cancelada'});
  }

  updateInstallButtonsVisibility();
});

async function initPWAVista(){
  const installed = await detectInstalled();
  if (installed){
    showView('view-bienvenida');
    startTypingLoop();  // ‚Üê aqu√≠ se arranca el texto autom√°tico
  } else {
    showView('view-instalar');
    updateInstallButtonsVisibility();
  }
}
if ('serviceWorker' in navigator){
  window.addEventListener('load', ()=>{
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  });
}
window.addEventListener('load', initPWAVista);

</script>
</body>
</html>
